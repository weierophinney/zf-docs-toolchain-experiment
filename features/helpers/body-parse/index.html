<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">   
    <link rel="shortcut icon" href="../../../img/favicon.ico">

    <title>Body Parsing Middleware - Expressive</title>

    <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../../css/base.css" rel="stylesheet">
    <link href="../../../css/cinder.css" rel="stylesheet">
    <link href="../../../css/prism-zf.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../../..">Expressive</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Getting Started <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../getting-started/features/">Overview and Features</a>
</li>

                        
                            
<li >
    <a href="../../../getting-started/standalone/">Quick Start: Standalone</a>
</li>

                        
                            
<li >
    <a href="../../../getting-started/skeleton/">Quick Start: Skeleton Installer</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Features <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../application/">Applications</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Containers</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../container/intro/">Introduction</a>
</li>

        
            
<li >
    <a href="../../container/factories/">Container Factories</a>
</li>

        
            
<li >
    <a href="../../container/zend-servicemanager/">Using zend-servicemanager</a>
</li>

        
            
<li >
    <a href="../../container/pimple/">Using Pimple</a>
</li>

        
            
<li >
    <a href="../../container/aura-di/">Using Aura.Di</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Routing Adapters</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../router/intro/">Introduction</a>
</li>

        
            
<li >
    <a href="../../router/interface/">Routing Interface</a>
</li>

        
            
<li >
    <a href="../../router/uri-generation/">URI Generation</a>
</li>

        
            
<li >
    <a href="../../router/result-observers/">Route Result Observers</a>
</li>

        
            
<li >
    <a href="../../router/piping/">Routing vs Piping</a>
</li>

        
            
<li >
    <a href="../../router/aura/">Using Aura</a>
</li>

        
            
<li >
    <a href="../../router/fast-route/">Using FastRoute</a>
</li>

        
            
<li >
    <a href="../../router/zf2/">Using the ZF2 Router</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Templating</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../template/intro/">Introduction</a>
</li>

        
            
<li >
    <a href="../../template/interface/">Template Renderer Interface</a>
</li>

        
            
<li >
    <a href="../../template/middleware/">Templated Middleware</a>
</li>

        
            
<li >
    <a href="../../template/plates/">Using Plates</a>
</li>

        
            
<li >
    <a href="../../template/twig/">Using Twig</a>
</li>

        
            
<li >
    <a href="../../template/zend-view/">Using zend-view</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../../error-handling/">Error Handling</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Helpers</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../intro/">Introduction</a>
</li>

        
            
<li >
    <a href="../url-helper/">UrlHelper</a>
</li>

        
            
<li >
    <a href="../server-url-helper/">ServerUrlHelper</a>
</li>

        
            
<li class="active">
    <a href="./">Body Parsing Middleware</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../../emitters/">Emitters</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cookbook <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../cookbook/common-prefix-for-routes/">Prepending a common path to all routes</a>
</li>

                        
                            
<li >
    <a href="../../../cookbook/route-specific-pipeline/">Route-specific middleware pipelines</a>
</li>

                        
                            
<li >
    <a href="../../../cookbook/custom-404-page-handling/">Setting custom 404 page handling</a>
</li>

                        
                            
<li >
    <a href="../../../cookbook/using-custom-view-helpers/">Registering custom view helpers when using zend-view</a>
</li>

                        
                            
<li >
    <a href="../../../cookbook/using-zend-form-view-helpers/">Using zend-form view helpers</a>
</li>

                        
                            
<li >
    <a href="../../../cookbook/using-a-base-path/">Using Expressive from a subdirectory</a>
</li>

                        
                            
<li >
    <a href="../../../cookbook/modular-layout/">Building modular applications</a>
</li>

                        
                            
<li >
    <a href="../../../cookbook/setting-locale-depending-routing-parameter/">Setting a locale based on a routing parameter</a>
</li>

                        
                            
<li >
    <a href="../../../cookbook/setting-locale-without-routing-parameter/">Setting a locale without a routing parameter</a>
</li>

                        
                            
<li >
    <a href="../../../cookbook/debug-toolbars/">Enabling debug toolbars</a>
</li>

                        
                            
<li >
    <a href="../../../cookbook/using-routed-middleware-class-as-controller/">Handling multiple routes in a single class</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../reference/usage-examples/">Examples</a>
</li>

                        
                            
<li >
    <a href="../../../reference/expressive-projects/">Expressive Projects</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Migration</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../reference/migration/rc-to-v1/">From RC5 and Earlier</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../server-url-helper/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../../emitters/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/zendframework/zend-expressive">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#body-parsing-middleware">Body Parsing Middleware</a></li>
        
            <li><a href="#registering-the-middleware">Registering the middleware</a></li>
        
            <li><a href="#strategies">Strategies</a></li>
        
            <li><a href="#removing-the-default-strategies">Removing the default strategies</a></li>
        
    
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="body-parsing-middleware">Body Parsing Middleware</h1>
<p><code>Zend\Expressive\Helper\BodyParams\BodyParamsMiddleware</code> provides generic PSR-7
middleware for parsing the request body into parameters, and returning a new
request instance that composes them. The subcomponent provides a strategy
pattern around matching the request <code>Content-Type</code>, and then parsing it, giving
you a flexible approach that can grow with your accepted content types.</p>
<p>By default, this middleware will detect the following content types:</p>
<ul>
<li><code>application/x-www-form-urlencoded</code> (standard web-based forms, without file
  uploads)</li>
<li><code>application/json</code>, <code>application/*+json</code> (JSON payloads)</li>
</ul>
<h2 id="registering-the-middleware">Registering the middleware</h2>
<p>You can register it manually:</p>
<pre class="codehilite"><code class="language-php">use Zend\Expressive\Helper\BodyParams\BodyParamsMiddleware;

$app-&gt;pipe(BodyParamsMiddleware::class);

// register other middleware
// register routing middleware
$app-&gt;run();</code></pre>


<p>or as pipeline middleware:</p>
<pre class="codehilite"><code class="language-php">// config/autoload/middleware-pipeline.global.php
use Zend\Expressive\Helper;

return [
    'dependencies' =&gt; [
        'invokables' =&gt; [
            Helper\BodyParams\BodyParamsMiddleware::class =&gt; Helper\BodyParams\BodyParamsMiddleware::class,
            /* ... */
        ],
        'factories' =&gt; [
            /* ... */
        ],
    ],
    'middleware_pipeline' =&gt; [
        [ 'middleware' =&gt; Helper\BodyParams\BodyParamsMiddleware::class, 'priority' =&gt; 100],
        /* ... */
        'routing' =&gt; [
            'middleware' =&gt; [
                Zend\Expressive\Container\ApplicationFactory::ROUTING_MIDDLEWARE,
                Helper\UrlHelperMiddleware::class,
                Zend\Expressive\Container\ApplicationFactory::DISPATCH_MIDDLEWARE,
            ],
            'priority' =&gt; 1,
        ],
        /* ... */
    ],
];</code></pre>


<p>Another option is to incorporate it in route-specific middleware queues:</p>
<pre class="codehilite"><code class="language-php">// config/autoload/routes.global.php
use Zend\Expressive\Helper\BodyParams\BodyParamsMiddleware;

return [
    'dependencies' =&gt; [
        'invokables' =&gt; [
            Helper\BodyParams\BodyParamsMiddleware::class =&gt; Helper\BodyParams\BodyParamsMiddleware::class,
            /* ... */
        ],
        'factories' =&gt; [
            /* ... */
        ],
    ],
    'routes' =&gt; [
        [
            'name' =&gt; 'contact:process',
            'path' =&gt; '/contact/process',
            'middleware' =&gt; [
                BodyParamsMiddleware::class,
                Contact\Process::class,
            ],
            'allowed_methods' =&gt; ['POST'],
        ]
    ],
];</code></pre>


<p>This latter approach has a slight advantage: the middleware will only execute
for routes that require the processing. While the middleware has some checks to
ensure it only triggers for HTTP methods that accept bodies, those checks are
still overhead that you might want to avoid; the above strategy of using the
middleware only with specific routes can accomplish that.</p>
<h2 id="strategies">Strategies</h2>
<p>If you want to intercept and parse other payload types, you can add <em>strategies</em>
to the middleware. Strategies implement <code>Zend\Expressive\Helper\BodyParams\StrategyInterface</code>:</p>
<pre class="codehilite"><code class="language-php">namespace Zend\Expressive\Helper\BodyParams;

use Psr\Http\Message\ServerRequestInterface;

interface StrategyInterface
{
    /**
     * Match the content type to the strategy criteria.
     *
     * @param string $contentType
     * @return bool Whether or not the strategy matches.
     */
    public function match($contentType);

    /**
     * Parse the body content and return a new response.
     *
     * @param ServerRequestInterface $request
     * @return ServerRequestInterface
     */
    public function parse(ServerRequestInterface $request);
}</code></pre>


<p>You then register them with the middleware using the <code>addStrategy()</code> method:</p>
<pre class="codehilite"><code class="language-php">$bodyParams-&gt;addStrategy(new MyCustomBodyParamsStrategy());</code></pre>


<p>To automate the registration, we recommend writing a factory for the
<code>BodyParamsMiddleware</code>, and replacing the <code>invokables</code> registration with a
registration in the <code>factories</code> section of the <code>middleware-pipeline.config.php</code>
file:</p>
<pre class="codehilite"><code class="language-php">use Zend\Expressive\Helper\BodyParams\BodyParamsMiddleware;

class MyCustomBodyParamsStrategyFactory
{
    public function __invoke($container)
    {
        $bodyParams = new BodyParamsMiddleware();
        $bodyParams-&gt;addStrategy(new MyCustomBodyParamsStrategy());
        return $bodyParams;
    }
}

// In config/autoload/middleware-pipeline.config.php:
use Zend\Expressive\Helper;

return [
    'dependencies' =&gt; [
        'invokables' =&gt; [
            // Remove this line:
            Helper\BodyParams\BodyParamsMiddleware::class =&gt; Helper\BodyParams\BodyParamsMiddleware::class,
            /* ... */
        ],
        'factories' =&gt; [
            // Add this line:
            Helper\BodyParams\BodyParamsMiddleware::class =&gt; MyCustomBodyParamsStrategyFactory::class,
            /* ... */
        ],
    ],
];</code></pre>


<h2 id="removing-the-default-strategies">Removing the default strategies</h2>
<p>By default, <code>BodyParamsMiddleware</code> composes the following strategies:</p>
<ul>
<li><code>Zend\Expressive\Helper\BodyParams\FormUrlEncodedStrategy</code></li>
<li><code>Zend\Expressive\Helper\BodyParams\JsonStrategy</code></li>
</ul>
<p>These provide the most basic approaches to parsing the request body. They
operate in the order they do to ensure the most common content type &mdash;
<code>application/x-www-form-urlencoded</code> &mdash; matches first, as the middleware
delegates parsing to the first match.</p>
<p>If you do not want to use these default strategies, you can clear them from the
middleware using <code>clearStrategies()</code>:</p>
<pre class="codehilite"><code class="language-php">$bodyParamsMiddleware-&gt;clearStrategies();</code></pre>


<p>Note: if you do this, <strong>all</strong> strategies will be removed! As such, we recommend
doing this only immediately before registering any custom strategies you might
be using.</p></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
        <small>Copyright (c) 2016 <a href="http://www.zend.com/">Zend Technologies USA Inc.</a><br></small>
        </p>
        <p><small><a href="http://framework.zend.com">Learn more about Zend Framework</a></small></p>
    </footer>

    <script src="../../../js/jquery-1.10.2.min.js"></script>
    <script src="../../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../../js/prism-zf.js"></script>

    <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
    <script src="../../../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
